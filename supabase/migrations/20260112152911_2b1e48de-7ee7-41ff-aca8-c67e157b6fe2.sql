-- Drop and recreate the function with correct parameter name
DROP FUNCTION IF EXISTS public.get_default_permissions_for_role(text);

CREATE OR REPLACE FUNCTION public.get_default_permissions_for_role(p_role text)
RETURNS jsonb
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
  CASE p_role
    WHEN 'admin' THEN
      RETURN jsonb_build_object(
        'dashboard_view', true,
        'leads_view', true,
        'leads_create', true,
        'leads_edit', true,
        'leads_delete', true,
        'leads_view_only_own', false,
        'leads_hide_new_button', false,
        'products_view', true,
        'products_manage', true,
        'sales_view', true,
        'sales_create', true,
        'sales_edit', true,
        'sales_delete', true,
        'sales_report_view', true,
        'expedition_report_view', true,
        'post_sale_view', true,
        'post_sale_manage', true,
        'sac_view', true,
        'sac_manage', true,
        'financial_view', true,
        'financial_manage', true,
        'whatsapp_view', true,
        'whatsapp_send', true,
        'whatsapp_v2_view', true,
        'whatsapp_manage_view', true,
        'ai_bots_view', true,
        'demands_view', true,
        'team_view', true,
        'team_manage', true,
        'settings_view', true,
        'settings_manage', true,
        'settings_funnel_stages', true,
        'settings_delivery_regions', true,
        'settings_carriers', true,
        'settings_payment_methods', true,
        'settings_non_purchase_reasons', true,
        'settings_standard_questions', true,
        'settings_teams', true,
        'settings_lead_sources', true,
        'receptive_view', true,
        'receptive_create', true
      );
    WHEN 'manager' THEN
      RETURN jsonb_build_object(
        'dashboard_view', true,
        'leads_view', true,
        'leads_create', true,
        'leads_edit', true,
        'leads_delete', false,
        'leads_view_only_own', false,
        'leads_hide_new_button', false,
        'products_view', true,
        'products_manage', false,
        'sales_view', true,
        'sales_create', true,
        'sales_edit', true,
        'sales_delete', false,
        'sales_report_view', true,
        'expedition_report_view', true,
        'post_sale_view', true,
        'post_sale_manage', true,
        'sac_view', true,
        'sac_manage', true,
        'financial_view', true,
        'financial_manage', false,
        'whatsapp_view', true,
        'whatsapp_send', true,
        'whatsapp_v2_view', true,
        'whatsapp_manage_view', true,
        'ai_bots_view', true,
        'demands_view', true,
        'team_view', true,
        'team_manage', false,
        'settings_view', true,
        'settings_manage', false,
        'settings_funnel_stages', false,
        'settings_delivery_regions', false,
        'settings_carriers', false,
        'settings_payment_methods', false,
        'settings_non_purchase_reasons', false,
        'settings_standard_questions', false,
        'settings_teams', false,
        'settings_lead_sources', false,
        'receptive_view', true,
        'receptive_create', true
      );
    WHEN 'seller' THEN
      RETURN jsonb_build_object(
        'dashboard_view', true,
        'leads_view', true,
        'leads_create', true,
        'leads_edit', true,
        'leads_delete', false,
        'leads_view_only_own', true,
        'leads_hide_new_button', false,
        'products_view', true,
        'products_manage', false,
        'sales_view', true,
        'sales_create', true,
        'sales_edit', false,
        'sales_delete', false,
        'sales_report_view', false,
        'expedition_report_view', false,
        'post_sale_view', false,
        'post_sale_manage', false,
        'sac_view', false,
        'sac_manage', false,
        'financial_view', false,
        'financial_manage', false,
        'whatsapp_view', true,
        'whatsapp_send', true,
        'whatsapp_v2_view', false,
        'whatsapp_manage_view', false,
        'ai_bots_view', false,
        'demands_view', false,
        'team_view', false,
        'team_manage', false,
        'settings_view', false,
        'settings_manage', false,
        'settings_funnel_stages', false,
        'settings_delivery_regions', false,
        'settings_carriers', false,
        'settings_payment_methods', false,
        'settings_non_purchase_reasons', false,
        'settings_standard_questions', false,
        'settings_teams', false,
        'settings_lead_sources', false,
        'receptive_view', true,
        'receptive_create', true
      );
    ELSE
      RETURN jsonb_build_object(
        'dashboard_view', true,
        'leads_view', true,
        'leads_create', false,
        'leads_edit', false,
        'leads_delete', false,
        'leads_view_only_own', true,
        'leads_hide_new_button', false,
        'products_view', true,
        'products_manage', false,
        'sales_view', false,
        'sales_create', false,
        'sales_edit', false,
        'sales_delete', false,
        'sales_report_view', false,
        'expedition_report_view', false,
        'post_sale_view', false,
        'post_sale_manage', false,
        'sac_view', false,
        'sac_manage', false,
        'financial_view', false,
        'financial_manage', false,
        'whatsapp_view', false,
        'whatsapp_send', false,
        'whatsapp_v2_view', false,
        'whatsapp_manage_view', false,
        'ai_bots_view', false,
        'demands_view', false,
        'team_view', false,
        'team_manage', false,
        'settings_view', false,
        'settings_manage', false,
        'settings_funnel_stages', false,
        'settings_delivery_regions', false,
        'settings_carriers', false,
        'settings_payment_methods', false,
        'settings_non_purchase_reasons', false,
        'settings_standard_questions', false,
        'settings_teams', false,
        'settings_lead_sources', false,
        'receptive_view', false,
        'receptive_create', false
      );
  END CASE;
END;
$$;